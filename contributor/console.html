<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo storage</title>
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet"
    >
    <script src="https://cdn.jsdelivr.net/gh/educentre-integration/libraries@latest/activity/bridge.min.js"></script>
</head>
<body class="p-4">

    <h1 class="mb-4">Console</h1>

    <div class="table-responsive">
        <table id="leaderboard" class="table table-striped table-bordered table-hover align-middle text-center">
            <caption class="caption-top fw-bold">Leaderboard</caption>
        </table>
    </div>

    <script>
        fetch("./local-data-for-console.json")
            .then(res => res.json())
            .then(data => {
                generateTable(data);
            });

        function generateTable(data) {
            const table = document.getElementById("leaderboard");

            // Construction de l'en-tÃªte
            const thead = document.createElement("thead");
            thead.classList.add("table-dark");
            thead.innerHTML = `
                <tr>
                    <th scope="col">Email</th>
                    <th scope="col">Score total</th>
                    <th scope="col">Nombre de coups</th>
                </tr>
            `;
            table.appendChild(thead);

            // Corps du tableau
            const tbody = document.createElement("tbody");

            data.forEach(entry => {
                const email = Object.keys(entry)[0];
                const { total_score, total_moves } = entry[email];

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${email}</td>
                    <td>${total_score}</td>
                    <td>${total_moves}</td>
                `;
                tbody.appendChild(row);
            });

            table.appendChild(tbody);
        }

        const eda = new EducentreActivity();

        function load() {
            eda.getStorage((storage) => {
                console.log(storage);
                const storageToDisplay = JSON.stringify(storage);
                document.querySelector('#storage').value = storageToDisplay;
            });
        }

        function save() {
            const storageToDisplay = document.querySelector('#storage').value;
            const storage = JSON.parse(storageToDisplay);
            eda.saveStorage(storage, (response) => {
                console.log(response);
            });
        }

    </script>

</body>
</html>
